<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible"  content="IE=edge">
        <meta name="viewport" content="with=device-width, initial-scale=1.0">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500&display=swap" rel="stylesheet">
        <style>
            body{
                background-color:#0D1137;
                width:100%;
                height:100%;
            }
            #container{
                width:100%;
                height:60%;
                margin-left:33%;
                margin-top:10%;
              
            }
            #chat{
                width:500px;
                height:500px;
                background-color:white;
                border-radius:30px;
                overflow-y:overlay;
                scroll-margin-left:100px;
            }
            #chat::-webkit-scrollbar{
       
                width:15px;
                background-color:white;
                border-radius:100px;
                height:5px;
                display:none;
            }

            #chat::-webkit-scrollbar-thumb{
                background:#FFF73D;
                border-radius:10px;
                min-height: 50px;
                background-clip: padding-box;
                border: 1px solid transparent;
               
            }
            }
            #chat::-webkit-scrollbar-track{
                background-color: #00ff0000;
           
        
            }
            #chatBox{
                background-color:#D8D8D8;
                width:400px;
                height:auto;
                border-radius:30px;
                margin:10px auto;
                display: relative;
            }
            #chatBox p{
                display:absolute;
                margin-top:10px;
                margin-bottom:10px;
            }
	    #popWho{
	    	
		height:auto;
		color:#03874F;
		text-align:center;
	    }
            #content{
               text-align: left;
               font-size:150%;
               margin-left:10%;
               display:inline-block;
            }
            #textUser{
              margin-left:60%;
              display:inline-block;
            }
            #chatForm{
               margin-top:20px;
               margin-left:5%;
            }
            input{
                width:300px;
                height:30px;
                border:none;
                background-color:#D8D8D8;
                border-radius:30px;
            }
            button{
                width:50px;
                height:30px;
                border:none;
                background-color:#FFF73D;
                border-radius:30px;
                
            }
        </style>
    </head>
    <body>
        <div id="container">
	    <input type="hidden" name="userEmail" id="userEmail" value="<%= currentUser.email %>">
	    <input type="hidden" name="roomId" id="roomId" value="<%= chatroomid %>">
	    
	    <div id="chat">
		    <% if(chatcontents) {%>
		   <% chatcontents.forEach(chatcontent => { %>
		    <div id="chatBox"><%= chatcontent.content %></div>
		    <% })}; %>
	    </div>
                <div id="chatForm">
		   
                    <form action="" method="POST">
                        <input type="text" id="inputChat" name="inputChat" autofocus>
                        <button type="button" id="sendChat" name="sendChat" >send</button>
                    </form>
                </div>
        </div>
	<script src="/socket.io/socket.io.js"></script>
	<script src="http://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script>
		$(() => {
			const socket = io();
			socket.on("connect", () => {
				let userName = $("#userEmail").val();
				socket.emit("newUser",userName);
			});
			socket.on("pop", (msg) => {
				$("#chat").prepend(`<div id="popWho">${msg}</div>`);
			});
			$("#sendChat").click(()=>{
				let content = $("#inputChat").val();
				let roomId = $("#roomId").val();
				socket.emit("message", content, roomId);
				return false;
			});
			socket.on("update", (msg,userName) => {
				let result = msg + "            @" + userName;
				$("#chat").prepend(`<div id="chatBox">${result}</div>`);
				
			});
		});
	</script>

	</script>
    </body>
</html>
